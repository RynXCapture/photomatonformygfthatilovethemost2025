<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photomaton</title>
<style>
    body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-x: hidden;
        background-color: red;
    }
    #background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        filter: blur(8px);
        z-index: -1;
    }
    #container {
        position: relative;
        width: 90vw;
        max-width: 400px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        margin-top: 20px;
        border-radius: 10px;
    }
    .photostrip {
        display: flex;
        flex-direction: column;
        gap: 10px;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
    }
    .photo {
        width: 100%;
        aspect-ratio: 3/2;
        background: gray;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        border-radius: 5px;
        position: relative;
    }
    video, img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    button {
        margin-top: 10px;
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        background: black;
        color: white;
    }
    .snap-btn {
        position: absolute;
        bottom: 5px;
        left: 5px;
        padding: 5px 8px;
        font-size: 14px;
        background: rgba(0,0,0,0.6);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    h1 {
        color: white;
        margin-top: 20px;
    }
</style>
</head>
<body>

<video id="background" autoplay muted loop playsinline>
    <source src="caca.mp4" type="video/mp4">
    Votre navigateur ne supporte pas la vidÃ©o.
</video>

<h1>Photomaton</h1>

<div id="container">
    <div class="photostrip" id="photostrip">
        <!-- Case 1 : Webcam -->
        <div class="photo" id="photo1">
            <video id="video1" autoplay playsinline></video>
            <button class="snap-btn" onclick="takePhoto(1)">ðŸ“·</button>
        </div>

        <!-- Case 2 : Image fixe -->
        <div class="photo">
            <img src="aram.jpg" alt="photo aram">
        </div>

        <!-- Case 3 : Webcam -->
        <div class="photo" id="photo3">
            <video id="video2" autoplay playsinline></video>
            <button class="snap-btn" onclick="takePhoto(3)">ðŸ“·</button>
        </div>

        <!-- Case 4 : Image fixe -->
        <div class="photo">
            <img src="ramam.jpg" alt="photo ramam">
        </div>
    </div>

    <button onclick="downloadPhotomaton()">TÃ©lÃ©charger</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
const video1 = document.getElementById('video1');
const video3 = document.getElementById('video2');
let stream;

// AccÃ¨s Ã  la camÃ©ra
navigator.mediaDevices.getUserMedia({ video: true })
.then(s => {
    stream = s;
    video1.srcObject = stream;
    video3.srcObject = stream;
})
.catch(err => console.error("Erreur d'accÃ¨s camÃ©ra :", err));

function takePhoto(photoId) {
    const video = photoId === 1 ? video1 : video3;
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0);
    const dataURL = canvas.toDataURL("image/jpeg");

    const img = document.createElement('img');
    img.src = dataURL;
    img.style.width = "100%";
    img.style.height = "100%";

    document.getElementById(`photo${photoId}`).innerHTML = "";
    document.getElementById(`photo${photoId}`).appendChild(img);
}

function downloadPhotomaton() {
    // On remplace les vidÃ©os par leurs images capturÃ©es
    [1, 3].forEach(id => {
        const photoDiv = document.getElementById(`photo${id}`);
        if (photoDiv.querySelector("video")) {
            const video = photoDiv.querySelector("video");
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            const img = document.createElement('img');
            img.src = canvas.toDataURL("image/jpeg");
            img.style.width = "100%";
            img.style.height = "100%";
            photoDiv.innerHTML = "";
            photoDiv.appendChild(img);
        }
    });

    const strip = document.getElementById("photostrip");
    html2canvas(strip, {useCORS: true, allowTaint: true}).then(canvas => {
        const link = document.createElement('a');
        link.download = 'photomaton.jpg';
        link.href = canvas.toDataURL("image/jpeg");
        link.click();
    }).catch(err => console.error("Erreur tÃ©lÃ©chargement :", err));
}
</script>
</body>
</html>


